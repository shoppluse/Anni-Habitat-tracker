<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anni's Habit Tracker</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f7fb;
      padding: 16px;
      color: #222;
    }
    .app {
      max-width: 900px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      padding: 16px;
    }
    .title-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      margin-bottom: 10px;
      font-weight: 600;
    }
    nav a {
      margin-right: 10px;
      font-size: 13px;
      text-decoration: none;
      color: #1f4f8f;
      font-weight: 600;
    }
    .helper-text {
      font-size: 12px;
      color: #666;
      margin: 12px 0;
    }
    .helper-text a { color: #1f4f8f; }
    .card {
      background: #f9fbff;
      border-radius: 8px;
      border: 1px solid #dde3f0;
      padding: 12px 16px;
      margin-bottom: 12px;
    }
    h2, h3 {
      font-size: 14px !important;
      margin-bottom: 10px !important;
      color: #2c3e50;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 12px;
      margin: 12px 0;
    }
    .stat {
      text-align: center;
      padding: 8px;
      background: white;
      border-radius: 6px;
      border: 1px solid #e1e8f0;
    }
    .stat-number { font-size: 24px; font-weight: 700; color: #1f4f8f; }
    .stat-label { font-size: 11px; color: #666; }
    .reset-btn {
      font-size: 11px;
      padding: 4px 8px;
      background: #fee;
      border: 1px solid #fcc;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 8px;
    }
    th, td {
      border: 1px solid #dde3f0;
      padding: 6px 8px;
      text-align: left;
    }
    th {
      background: #f1f3f8;
      font-weight: 600;
    }
    .day-header { background: #e8f0fe !important; }

    /* Day cell with progress bar */
    .day-cell {
      min-height: 32px !important;
      padding: 8px 4px !important;
      font-size: 13px !important;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      text-align: center;
      background-size: 100% 100%;
      background-repeat: no-repeat;
    }
    .day-cell .day-label {
      position: relative;
      z-index: 1;
    }
    .day-cell:hover { background: #e3f2fd !important; }
    .day-cell:active {
      filter: brightness(0.92) !important;
      transition: filter 0.1s;
    }

    .habit-editor { margin: 12px 0; }
    .habit-row {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      padding: 8px;
      background: white;
      border-radius: 6px;
      border: 1px solid #e1e8f0;
      transition: background 0.3s;
    }
    .habit-row.editing { background: #e6f7ff !important; }
    .habit-input {
      flex: 1;
      border: none;
      font-size: 13px;
      padding: 4px;
      background: transparent;
    }
    .habit-input:focus {
      outline: 2px solid #1f4f8f;
      border-radius: 4px;
    }
    .delete-btn {
      background: #fee;
      border: 1px solid #fcc;
      color: #c53030;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      margin-left: 8px;
    }
    .editor-hint {
      font-size: 11px;
      color: #888;
      margin-top: 4px;
    }
    tbody tr:nth-child(even) {
      background: #f5f7fc;
    }
    .empty {
      font-size: 13px;
      margin-top: 8px;
      color: #666;
    }

    /* Today panel toggle */
    .toggle-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      font-size: 13px;
      margin-top: 4px;
    }
    .toggle-header span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .toggle-arrow {
      transition: transform 0.2s;
      font-size: 14px;
    }
    .toggle-arrow.open {
      transform: rotate(90deg);
    }
    #todayPanel {
      margin-top: 8px;
      border-top: 1px dashed #dde3f0;
      padding-top: 8px;
      display: none;
    }
    .today-habit-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px 0;
      font-size: 13px;
    }
    .today-habit-row label {
      flex: 1;
    }
    .today-habit-row input[type="checkbox"] {
      margin-right: 8px;
    }

    /* Movable cat */
    .cat-float {
      position: fixed;
      bottom: 16px;
      right: 16px;
      width: 70px;
      cursor: grab;
      z-index: 1000;
    }
    .cat-float.dragging {
      cursor: grabbing;
    }
  </style>
</head>
<body>
  <!-- Movable cat -->
  <img src="image-12.png" alt="Anni cat" class="cat-float" id="anniCat">

  <div class="app">
    <div class="title-bar">
      <div>üê± Anni's Habit Tracker</div>
      <div><a href="history.html" style="font-size:12px; text-decoration:none; color:#1f4f8f;">History ‚Üí</a></div>
    </div>

    <nav>
      <a href="index.html">Dashboard</a>
      <a href="history.html">History</a>
    </nav>

    <p class="helper-text">
      ‚úèÔ∏è Edit habits below ‚Ä¢ üìä View exact dates/times in <a href="history.html">History</a>
    </p>

    <div class="card">
      <h2>üìä This Month Stats</h2>
      <div class="stats-grid" id="statsGrid">
        <div class="stat">
          <div class="stat-number" id="totalDone">0</div>
          <div class="stat-label">Total Done</div>
        </div>
        <div class="stat">
          <div class="stat-number" id="streak">0</div>
          <div class="stat-label">Current Streak</div>
        </div>
        <div class="stat">
          <div class="stat-number" id="bestStreak">0</div>
          <div class="stat-label">Best Streak</div>
        </div>
      </div>
      <button class="reset-btn" onclick="resetMonth()">üóëÔ∏è Reset this month</button>
    </div>

    <div class="card">
      <h3>üìÖ Calendar</h3>
      <table id="calendar">
        <thead id="calendarHead"></thead>
        <tbody id="calendarBody"></tbody>
      </table>

      <div class="toggle-header" onclick="toggleTodayPanel()">
        <span>
          <span class="toggle-arrow" id="todayArrow">‚ñ∂</span>
          Today‚Äôs habits
        </span>
        <span style="font-size:11px; color:#777;">Tap to show / hide</span>
      </div>
      <div id="todayPanel"></div>
    </div>

    <div class="card">
      <h3>üìà Weekly Progress</h3>
      <table id="weeklyTable">
        <thead>
          <tr>
            <th>Week</th><th>Mon</th><th>Tue</th><th>Wed</th>
            <th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th><th>Total</th>
          </tr>
        </thead>
        <tbody id="weeklyBody"></tbody>
      </table>
    </div>

    <div class="card">
      <h3>üìã Monthly Overview</h3>
      <table id="monthlyTable">
        <thead id="monthlyHead"></thead>
        <tbody id="monthlyBody"></tbody>
      </table>
    </div>

    <div class="card">
      <h3>‚úèÔ∏è Your Habits</h3>
      <div class="habit-editor" id="habitEditor"></div>
      <div class="editor-hint">Changes saved automatically ‚Ä¢ Add/rename/delete as needed</div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const HABITS_KEY = "anniHabits";
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth();
      const storageKey = `habit-${year}-${month + 1}`;
      let stored = JSON.parse(localStorage.getItem(storageKey) || "{}");

      function loadHabits() {
        const json = localStorage.getItem(HABITS_KEY);
        if (json) return JSON.parse(json);
        return [
          "Wake up @ 6AM",
          "No Social Media till 9",
          "Workout / Walking",
          "Study, 60 min",
          "Read 30 min"
        ];
      }

      let habits = loadHabits();

      function saveHabits() {
        localStorage.setItem(HABITS_KEY, JSON.stringify(habits));
      }

      function toggleHabit(hIndex, day) {
        const key = `${hIndex}-${day}`;
        if (!stored[key]) stored[key] = {};
        stored[key].done = !stored[key].done;
        if (stored[key].done) {
          stored[key].completedAt = new Date().toISOString();
        } else {
          delete stored[key].completedAt;
        }
        localStorage.setItem(storageKey, JSON.stringify(stored));
        renderAll();
      }

      window.resetMonth = function() {
        if (confirm("Clear all data for this month?")) {
          localStorage.removeItem(storageKey);
          stored = {};
          renderAll();
        }
      };

      function renderAll() {
        renderStats();
        renderCalendar();
        renderWeekly();
        renderMonthly();
        renderHabits();
        renderTodayPanel();
      }

      function renderStats() {
        let totalDone = 0;
        let currentStreak = 0;
        let best = 0;
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for (let day = 1; day <= daysInMonth; day++) {
          let dayDone = 0;
          habits.forEach((_, hIndex) => {
            const key = `${hIndex}-${day}`;
            if (stored[key] && stored[key].done) dayDone++;
          });
          totalDone += dayDone;
          if (dayDone === habits.length && habits.length > 0) {
            currentStreak++;
            best = Math.max(best, currentStreak);
          } else {
            currentStreak = 0;
          }
        }

        document.getElementById("totalDone").textContent = totalDone;
        document.getElementById("streak").textContent = currentStreak;
        document.getElementById("bestStreak").textContent = best;
      }

      function renderCalendar() {
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const firstDay = new Date(year, month, 1).getDay();
        let html = "<tr>" + "<th class='day-header'>Day</th>".repeat(7) + "</tr>";
        let day = 1;

        for (let i = 0; i < 6; i++) {
          html += "<tr>";
          for (let j = 0; j < 7; j++) {
            if (i === 0 && j < firstDay) {
              html += "<td></td>";
            } else if (day > daysInMonth) {
              html += "<td></td>";
            } else {
              let dayDone = 0;
              habits.forEach((_, hIndex) => {
                const key = `${hIndex}-${day}`;
                if (stored[key] && stored[key].done) dayDone++;
              });
              const todayDay = today.getDate();
              const pct = habits.length ? (dayDone / habits.length) * 100 : 0;

              let barColor = "#d4edda";              // full/partial base
              if (pct > 0 && pct < 100) barColor = "#ffe58a"; // yellow when partial

              html += `<td class="day-cell ${day === todayDay ? "today" : ""}"
                         style="background-image: linear-gradient(to right, ${barColor} 0%, ${barColor} ${pct}%, transparent ${pct}%, transparent 100%);"
                         onclick="toggleDay(${day})">
                         <span class="day-label">${day}</span>
                       </td>`;
              day++;
            }
          }
          html += "</tr>";
          if (day > daysInMonth) break;
        }

        document.getElementById("calendarBody").innerHTML = html;
      }

      window.toggleDay = function(day) {
        habits.forEach((_, hIndex) => {
          const key = `${hIndex}-${day}`;
          const existing = stored[key] && stored[key].done;
          if (!stored[key]) stored[key] = {};
          const newState = !existing;
          stored[key].done = newState;
          if (newState) {
            stored[key].completedAt = new Date().toISOString();
          } else {
            delete stored[key].completedAt;
          }
        });
        localStorage.setItem(storageKey, JSON.stringify(stored));
        renderAll();
      };

      function renderWeekly() {
        document.getElementById("weeklyBody").innerHTML =
          "<tr><td colspan='9' style='text-align:center;color:#666;'>Weekly breakdown coming soon</td></tr>";
      }

      function renderMonthly() {
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        let html = "";
        habits.forEach((habit, hIndex) => {
          let doneCount = 0;
          for (let day = 1; day <= daysInMonth; day++) {
            const key = `${hIndex}-${day}`;
            if (stored[key] && stored[key].done) doneCount++;
          }
          html += `<tr><td>${habit}</td><td>${doneCount}/${daysInMonth}</td></tr>`;
        });
        document.getElementById("monthlyHead").innerHTML =
          "<tr><th>Habit</th><th>Done</th></tr>";
        document.getElementById("monthlyBody").innerHTML = html;
      }

      function renderHabits() {
        const container = document.getElementById("habitEditor");
        container.innerHTML = "";
        habits.forEach((habit, index) => {
          const row = document.createElement("div");
          row.className = "habit-row";
          row.innerHTML = `
            <input class="habit-input" value="${habit}"
              oninput="updateHabit(${index}, this.value)"
              onfocus="this.parentElement.classList.add('editing')"
              onblur="this.parentElement.classList.remove('editing')">
            <button class="delete-btn" onclick="deleteHabit(${index})">Delete</button>
          `;
          container.appendChild(row);
        });

        const addBtn = document.createElement("div");
        addBtn.style.cssText =
          "padding:8px; cursor:pointer; color:#1f4f8f; font-size:13px;";
        addBtn.innerHTML = "+ Add new habit";
        addBtn.onclick = addHabit;
        container.appendChild(addBtn);
      }

      window.updateHabit = function(index, name) {
        habits[index] = name;
        saveHabits();
        renderAll();
      };

      window.deleteHabit = function(index) {
        if (habits.length > 1 && confirm("Delete this habit?")) {
          habits.splice(index, 1);
          saveHabits();
          renderAll();
        }
      };

      window.addHabit = function() {
        const name = prompt("New habit name:");
        if (name && name.trim()) {
          habits.push(name.trim());
          saveHabits();
          renderAll();
        }
      };

      window.toggleTodayPanel = function() {
        const panel = document.getElementById("todayPanel");
        const arrow = document.getElementById("todayArrow");
        const isOpen = panel.style.display === "block";
        panel.style.display = isOpen ? "none" : "block";
        arrow.classList.toggle("open", !isOpen);
      };

      function renderTodayPanel() {
        const panel = document.getElementById("todayPanel");
        if (!panel) return;

        const day = today.getDate();
        panel.innerHTML = "";

        if (!habits.length) {
          panel.innerHTML =
            "<div style='font-size:12px; color:#777;'>No habits defined.</div>";
          return;
        }

        habits.forEach((habit, hIndex) => {
          const key = `${hIndex}-${day}`;
          const isDone = stored[key] && stored[key].done;

          const row = document.createElement("div");
          row.className = "today-habit-row";
          row.innerHTML = `
            <label>
              <input type="checkbox" ${isDone ? "checked" : ""}
                onchange="toggleTodayHabit(${hIndex}, ${day}, this.checked)">
              ${habit}
            </label>
          `;
          panel.appendChild(row);
        });
      }

      window.toggleTodayHabit = function(hIndex, day, checked) {
        const key = `${hIndex}-${day}`;
        if (!stored[key]) stored[key] = {};
        stored[key].done = checked;

        if (checked) {
          stored[key].completedAt = new Date().toISOString();
        } else {
          delete stored[key].completedAt;
        }

        localStorage.setItem(storageKey, JSON.stringify(stored));
        renderAll();
      };

      renderAll();

      // === Draggable cat ===
      const cat = document.getElementById("anniCat");
      if (cat) {
        let isDown = false;
        let offsetX = 0;
        let offsetY = 0;

        cat.addEventListener("mousedown", startDrag);
        cat.addEventListener("touchstart", startDrag, { passive: false });

        function startDrag(e) {
          e.preventDefault();
          isDown = true;
          cat.classList.add("dragging");

          const clientX = e.touches ? e.touches[0].clientX : e.clientX;
          const clientY = e.touches ? e.touches[0].clientY : e.clientY;

          const rect = cat.getBoundingClientRect();
          offsetX = clientX - rect.left;
          offsetY = clientY - rect.top;

          document.addEventListener("mousemove", onDrag);
          document.addEventListener("mouseup", endDrag);
          document.addEventListener("touchmove", onDrag, { passive: false });
          document.addEventListener("touchend", endDrag);
        }

        function onDrag(e) {
          if (!isDown) return;
          e.preventDefault();

          const clientX = e.touches ? e.touches[0].clientX : e.clientX;
          const clientY = e.touches ? e.touches[0].clientY : e.clientY;

          let x = clientX - offsetX;
          let y = clientY - offsetY;

          const maxX = window.innerWidth - cat.offsetWidth;
          const maxY = window.innerHeight - cat.offsetHeight;

          if (x < 0) x = 0;
          if (y < 0) y = 0;
          if (x > maxX) x = maxX;
          if (y > maxY) y = maxY;

          cat.style.left = x + "px";
          cat.style.top = y + "px";
          cat.style.right = "auto";
          cat.style.bottom = "auto";
        }

        function endDrag() {
          isDown = false;
          cat.classList.remove("dragging");
          document.removeEventListener("mousemove", onDrag);
          document.removeEventListener("mouseup", endDrag);
          document.removeEventListener("touchmove", onDrag);
          document.removeEventListener("touchend", endDrag);
        }
      }
    });
  </script>
</body>
</html>
