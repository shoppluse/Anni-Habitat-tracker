<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anni's Habit Tracker</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f7fb;
      padding: 16px;
      color: #222;
    }
    .app {
      max-width: 900px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      padding: 16px;
    }
    .title-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      margin-bottom: 10px;
      font-weight: 600;
    }
    nav a {
      margin-right: 10px;
      font-size: 13px;
      text-decoration: none;
      color: #1f4f8f;
      font-weight: 600;
    }
    .helper-text {
      font-size: 12px; 
      color: #666; 
      margin: 12px 0;
    }
    .helper-text a { color: #1f4f8f; }
    .card {
      background: #f9fbff;
      border-radius: 8px;
      border: 1px solid #dde3f0;
      padding: 12px 16px;
      margin-bottom: 12px; /* Breathing room between cards */
    }
    h2, h3 { 
      font-size: 14px !important; 
      margin-bottom: 10px !important;
      color: #2c3e50;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 12px;
      margin: 12px 0;
    }
    .stat {
      text-align: center;
      padding: 8px;
      background: white;
      border-radius: 6px;
      border: 1px solid #e1e8f0;
    }
    .stat-number { font-size: 24px; font-weight: 700; color: #1f4f8f; }
    .stat-label { font-size: 11px; color: #666; }
    .reset-btn {
      font-size: 11px; 
      padding: 4px 8px; 
      background: #fee; 
      border: 1px solid #fcc; 
      border-radius: 4px; 
      cursor: pointer;
      margin-left: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 8px;
    }
    th, td {
      border: 1px solid #dde3f0;
      padding: 6px 8px;
      text-align: left;
    }
    th {
      background: #f1f3f8;
      font-weight: 600;
    }
    .day-header { background: #e8f0fe !important; } /* Visual anchor */
    .day-cell {
      min-height: 32px !important; /* Bigger touch target */
      padding: 8px 4px !important;
      font-size: 13px !important;
      cursor: pointer;
      transition: all 0.2s;
    }
    .day-cell:hover { background: #e3f2fd !important; }
    .day-cell:active { 
      filter: brightness(0.92) !important; 
      transition: filter 0.1s;
    }
    .done { background: #d4edda !important; color: #155724; }
    .habit-editor {
      margin: 12px 0;
    }
    .habit-row {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      padding: 8px;
      background: white;
      border-radius: 6px;
      border: 1px solid #e1e8f0;
      transition: background 0.3s;
    }
    .habit-row.editing { background: #e6f7ff !important; }
    .habit-input {
      flex: 1;
      border: none;
      font-size: 13px;
      padding: 4px;
      background: transparent;
    }
    .habit-input:focus {
      outline: 2px solid #1f4f8f;
      border-radius: 4px;
    }
    .delete-btn {
      background: #fee;
      border: 1px solid #fcc;
      color: #c53030;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      margin-left: 8px;
    }
    .editor-hint {
      font-size: 11px; 
      color: #888; 
      margin-top: 4px;
    }
    tbody tr:nth-child(even) {
      background: #f5f7fc;
    }
    .empty {
      font-size: 13px;
      margin-top: 8px;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="title-bar">
      <div>üê± Anni's Habit Tracker</div>
      <div><a href="history.html" style="font-size:12px; text-decoration:none; color:#1f4f8f;">History ‚Üí</a></div>
    </div>

    <nav>
      <a href="index.html">Dashboard</a>
      <a href="history.html">History</a>
    </nav>

    <p class="helper-text">
      ‚úèÔ∏è Edit habits below ‚Ä¢ üìä View exact dates/times in <a href="history.html">History</a>
    </p>

    <div class="card">
      <h2>üìä This Month Stats</h2>
      <div class="stats-grid" id="statsGrid">
        <div class="stat">
          <div class="stat-number" id="totalDone">0</div>
          <div class="stat-label">Total Done</div>
        </div>
        <div class="stat">
          <div class="stat-number" id="streak">0</div>
          <div class="stat-label">Current Streak</div>
        </div>
        <div class="stat">
          <div class="stat-number" id="bestStreak">0</div>
          <div class="stat-label">Best Streak</div>
        </div>
      </div>
      <button class="reset-btn" onclick="resetMonth()">üóëÔ∏è Reset this month</button>
    </div>

    <div class="card">
      <h3>üìÖ Calendar</h3>
      <table id="calendar">
        <thead id="calendarHead"></thead>
        <tbody id="calendarBody"></tbody>
      </table>
    </div>

    <div class="card">
      <h3>üìà Weekly Progress</h3>
      <table id="weeklyTable">
        <thead><tr><th>Week</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th><th>Total</th></tr></thead>
        <tbody id="weeklyBody"></tbody>
      </table>
    </div>

    <div class="card">
      <h3>üìã Monthly Overview</h3>
      <table id="monthlyTable">
        <thead id="monthlyHead"></thead>
        <tbody id="monthlyBody"></tbody>
      </table>
    </div>

    <div class="card">
      <h3>‚úèÔ∏è Your Habits</h3>
      <div class="habit-editor" id="habitEditor"></div>
      <div class="editor-hint">Changes saved automatically ‚Ä¢ Add/rename/delete as needed</div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Constants
      const HABITS_KEY = "anniHabits";
      const WEEKDAYS = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

      // Load habits
      function loadHabits() {
        const json = localStorage.getItem(HABITS_KEY);
        if (json) return JSON.parse(json);
        return [
          "Wake up @ 6AM",
          "No Social Media till 9",
          "Workout / Walking",
          "Study, 60 min",
          "Read 30 min"
        ];
      }

      let habits = loadHabits();
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth();
      const storageKey = `habit-${year}-${month + 1}`;
      let stored = JSON.parse(localStorage.getItem(storageKey) || "{}");

      // Save habits
      function saveHabits() {
        localStorage.setItem(HABITS_KEY, JSON.stringify(habits));
      }

      // Toggle habit
      function toggleHabit(hIndex, day) {
        const key = `${hIndex}-${day}`;
        if (!stored[key]) stored[key] = {};
        stored[key].done = !stored[key].done;
        if (stored[key].done) {
          stored[key].completedAt = new Date().toISOString();
        } else {
          delete stored[key].completedAt;
        }
        localStorage.setItem(storageKey, JSON.stringify(stored));
        renderAll();
      }

      // Reset month
      window.resetMonth = function() {
        if (confirm('Clear all data for this month?')) {
          localStorage.removeItem(storageKey);
          stored = {};
          renderAll();
        }
      };

      // Render everything
      function renderAll() {
        renderStats();
        renderCalendar();
        renderWeekly();
        renderMonthly();
        renderHabits();
      }

      // Stats
      function renderStats() {
        let totalDone = 0, streak = 0, bestStreak = 0;
        let currentStreak = 0, best = 0;
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for (let day = 1; day <= daysInMonth; day++) {
          let dayDone = 0;
          habits.forEach((_, hIndex) => {
            const key = `${hIndex}-${day}`;
            if (stored[key] && stored[key].done) dayDone++;
          });
          totalDone += dayDone;
          if (dayDone === habits.length) {
            currentStreak++;
            best = Math.max(best, currentStreak);
          } else {
            currentStreak = 0;
          }
        }
        document.getElementById("totalDone").textContent = totalDone;
        document.getElementById("streak").textContent = currentStreak;
        document.getElementById("bestStreak").textContent = best;
      }

      // Calendar
      function renderCalendar() {
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const firstDay = new Date(year, month, 1).getDay();
        let html = "<tr>" + "<th class='day-header'>Day</th>".repeat(7) + "</tr>";
        let day = 1;

        for (let i = 0; i < 6; i++) {
          html += "<tr>";
          for (let j = 0; j < 7; j++) {
            if (i === 0 && j < firstDay) {
              html += "<td></td>";
            } else if (day > daysInMonth) {
              html += "<td></td>";
            } else {
              let dayDone = 0;
              habits.forEach((_, hIndex) => {
                const key = `${hIndex}-${day}`;
                if (stored[key] && stored[key].done) dayDone++;
              });
              const pct = dayDone / habits.length;
              const todayDay = today.getDate();
              html += `<td class="day-cell ${dayDone > 0 ? 'done' : ''} ${day === todayDay ? 'today' : ''}" 
                       onclick="toggleHabitAll(${day})">${day}</td>`;
              day++;
            }
          }
          html += "</tr>";
          if (day > daysInMonth) break;
        }

        document.getElementById("calendarBody").innerHTML = html;
      }

      // Weekly
      function renderWeekly() {
        // Simplified weekly render - implement as needed
        document.getElementById("weeklyBody").innerHTML = "<tr><td colspan='8' style='text-align:center;color:#666;'>Weekly breakdown coming soon</td></tr>";
      }

      // Monthly
      function renderMonthly() {
        let html = "";
        habits.forEach((habit, hIndex) => {
          let doneCount = 0;
          const daysInMonth = new Date(year, month + 1, 0).getDate();
          for (let day = 1; day <= daysInMonth; day++) {
            const key = `${hIndex}-${day}`;
            if (stored[key] && stored[key].done) doneCount++;
          }
          html += `<tr><td>${habit}</td><td>${doneCount}/${daysInMonth}</td></tr>`;
        });
        document.getElementById("monthlyHead").innerHTML = "<tr><th>Habit</th><th>Done</th></tr>";
        document.getElementById("monthlyBody").innerHTML = html;
      }

      // Habits editor
      function renderHabits() {
        const container = document.getElementById("habitEditor");
        container.innerHTML = "";
        habits.forEach((habit, index) => {
          const row = document.createElement("div");
          row.className = "habit-row";
          row.innerHTML = `
            <input class="habit-input" value="${habit}" onchange="updateHabit(${index}, this.value)" 
                   onblur="saveHabits()" onfocus="this.parentElement.classList.add('editing')">
            <button class="delete-btn" onclick="deleteHabit(${index})">Delete</button>
          `;
          container.appendChild(row);
        });

        // Add habit button
        const addBtn = document.createElement("div");
        addBtn.style.cssText = "padding:8px; cursor:pointer; color:#1f4f8f; font-size:13px;";
        addBtn.innerHTML = "+ Add new habit";
        addBtn.onclick = addHabit;
        container.appendChild(addBtn);
      }

      // Habit editor functions
      window.updateHabit = function(index, name) {
        habits[index] = name;
        saveHabits();
        renderAll();
      };

      window.deleteHabit = function(index) {
        if (habits.length > 1 && confirm("Delete this habit?")) {
          habits.splice(index, 1);
          saveHabits();
          renderAll();
        }
      };

      window.addHabit = function() {
        const name = prompt("New habit name:");
        if (name && name.trim()) {
          habits.push(name.trim());
          saveHabits();
          renderAll();
        }
      };

      // Initial render
      renderAll();
    });
  </script>
</body>
</html>
